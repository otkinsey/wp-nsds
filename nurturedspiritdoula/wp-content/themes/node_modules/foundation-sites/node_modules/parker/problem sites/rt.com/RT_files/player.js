function showPlayer(link) {
    var $this = $(link);
    var videourl = $this.attr('href')
        .replace(/\/original\_/, '/')
        .replace(/\.asf$/, '.mp4')
        .replace(/\.mxf$/, '.mp4')
        .replace(/\.mov$/, '.mp4');
    var width = ($this.data('width'))? $this.data('width') : 681;
    var height = ($this.data('height'))? $this.data('height') : 384;
    var window_width = $(window).width();
    if(window_width <= 864) {
        width = window_width-20;
        height = Math.round(width/16*9);
    }

    var curVideoIdStr = 'inline_video_' + currentVideoID;
    var videoContainer = $('<div id="' + curVideoIdStr + '"></div>');
    var poster = $this.data('poster_url') ? $this.data('poster_url') : '/static/img/RT.jpg';
    var alt = $this.data('alt') ? $this.data('alt') : '';
    var start_param = 'ec_seek';
    //alert($this.attr('href'));
    $this.after(videoContainer);
    if (typeof player_ads_tag == 'undefined') {
        player_ads_tag = 'http://pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/144751494/en_video_static&ciu_szs&impl=s&gdfp_req=1&env=vp&output=xml_vast2&unviewed_position_start=1&url='+encodeURIComponent(location.href)+'&correlator='+Date.now();
    }
    jwplayer(curVideoIdStr).setup({
        image: poster,
        sources: [{
            file: videourl,
            label: "Standard"
        }],
        startparam: "ec_seek",
        width: width,
        height: height,
        skin: "/st/rtplayer/rtskin.xml",
        abouttext: 'RT',
        aboutlink: 'http://rt.com',
        sharing: {
            link: location.href
        },
        primary: 'flash',
        advertising: {
            client: 'vast',
            tag: player_ads_tag
        },
        events: {
          onPlay: function(){
            myStreamingTag.playVideoContentPart(metadata);
          },
          onPause: function(){
            myStreamingTag.stop();
          },
          onComplete: function(){
            myStreamingTag.stop();
          }
        }
    });
    jwplayer().onReady(function(){
        is_player_setted = true;
    });
    if (typeof playerDownloadButton == 'undefined' || playerDownloadButton) {
        jwplayer().addButton(
            "/st/rtplayer/download.png",
            "Download Video",
            function() {
                var file_url = jwplayer().getPlaylist()[0].sources[0].file
                window.open(file_url + '?event=download', '_blank');
            },
            "download"
        );
    }
    jwplayer().onPlay(function(){
        $('#'+this.id).parents('.article_img').find('.article_img_footer').hide();
    });
    $this.hide();
    currentVideoID++;
}

var currentVideoID = 1;
var is_player_setted = false;
$(function () {
    $('.video-link-autoprocess').each(function () {
        showPlayer(this);
    });

    $(window).resize(function(){
        if(is_player_setted) {
            var $this = $('.video-link-autoprocess');
            var width = ($this.data('width'))? $this.data('width') : 681;
            var height = ($this.data('height'))? $this.data('height') : 384;
            var window_width = $(window).width();
            if(window_width >= 1000 && (typeof full_width_player != "undefined") && full_width_player) {
              width = 980;
              height = 555;
            }
            if(window_width <= 864) {
                width = window_width-20;
                height = Math.round(width/16*9);
            }
            jwplayer().resize(width, height);
        }
    });
});